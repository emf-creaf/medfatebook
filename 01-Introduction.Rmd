# (PART) Preliminaries {-}

# Introduction {#intro}

This chapter provides an overview of the purpose under the development of **medfate**, its main simulation functions and applications. 

## Purpose

Being able to anticipate the impact of global change on ecosystems is one of the major environmental challenges in contemporary societies. However, uncertainties in how ecological systems function and practical constraints in how to integrate available information prevent the development of robust and reliable predictive models. Despite the amount of knowledge accumulated about the functioning and dynamics of Mediterranean forests, scientists should make coordinate their efforts to address the challenge of integrating the different global change drivers in a modelling framework useful for research and applications.

The R package **medfate** has been designed to simulate the functioning and dynamics of Mediterranean forest stands at temporal scales from days to years. Fire and drought impacts are the main subjects covered by the package, although eco-hydrological processes are fundamental for the simulation models included in the package. In particular, the package allows the simulation of water balance of soils and plants within forest stands. It also allows simulating plant growth of a set of cohorts competing for light and water within a forest stand. Finally, the package also includes functions to relate the amount of plant biomass and the relative water content of plant tissues to live fuel moisture content, hence, fire hazard.

The version of the reference manual that you are reading is intended to reflect **version `r packageVersion("medfate")`** of the package.

## Package installation

Package **medfate** can be found at [CRAN](https://CRAN.R-project.org/package=medfate), where it is updated every few months. Hence, it can be installed using:
```{r eval=FALSE}
install.packages("medfate")
```

Users can also download and install the latest stable versions GitHub as follows (required package `devtools` should be installed/updated first):

```{r installation, eval = FALSE}
devtools::install_github("vegmod/medfate")
```

When installing from GitHub, may need to force the installation of package vignettes, by using: 

```{r installation vignettes, eval = FALSE}
devtools::install_github("vegmod/medfate", 
                         build_opts = c("--no-resave-data", "--no-manual"))
```


## Package functions

### Dynamic simulation functions

Forest water and energy balance can be studied for a given forest stand using function `spwb()`. This function allows simulating vertical hydrological processes and some plant physiological processes (hydraulics, photosynthesis and stomatal regulation).  The same function is used to run two models of different degree of complexity, from which the user should choose depending on the intended application. Most processes are implemented at the daily scale, although others operate at subdaily steps.

Changes in leaf area and plant growth are key to evaluate the influence of climatic conditions on forest structure and function. Function `growth()` extends the previous models because it allows simulating  growth of a set of plant cohorts competing for light and water in a given forest stand. It can be used to forecast temporal variation in water fluxes and soil water content in forest stands while taking into account processes determining leaf area changes and plant growth.

While all simulation functions in the package focus on particular forest stands and vertical hydrological processes, the package has been designed so that it could be part of a broader modelling framework including lateral water flows.

### Sub-model functions

Many of the functions included in **medfate** are internally called by simulation functions. Some of them are made available to the user, to facilitate understanding the different sub-models and to facilitate a more creative use of the package. Sub-model functions are grouped by *subject*, which is included in the name of the function. The different sub-model functions are (by subject):

* `biophysics_*`: Physical and biophysical utility functions.
* `hydraulics_*`: Plant hydraulics.
* `hydrology_*`: Canopy and soil hydrology (rainfall interception, soil evaporation, soil infiltration).
* `light_*`: Light extinction and absortion.
* `moisture_*`: Live tissue moisture.
* `pheno_*`: Leaf phenology.
* `photo_*`: Leaf photosynthesis.
* `root_*`: Root distribution and conductance calculations.
* `soil_*`: Soil hydraulics and thermodynamics.
* `spwb_*`: Soil water balance parameter optimization/calibration routines.
* `transp_*`: Stomatal regulation and resulting transpiration/photosynthesis.

### Static functions

Package **medfate** include a number of functions to examine properties of the plants conforming forests, summary functions at the stand level or vertical profiles of several physical properties:

* `plant_*`: Cohort-level information (species name, id, leaf area, height...).
* `species_*`: Cohort-level attributes aggregated by species (e.g. basal area).
* `stand_*`: Stand-level attributes (e.g. basal area).
* `vprofile_*`: Vertical profiles (light, wind, fuel density, leaf area density).

Vegetation functioning and dynamics have strong, but complex, effects on fire hazard. On one hand, growth and death of organs and individuals changes the amount of standing live and dead fuels, as well as downed dead fuels. On the other, day-to-day changes in soil and plant water content changes the physical properties of fuel, notably fuel moisture content. Package **medfate** provides functions to estimate fuel properties and potential fire behaviour in forest inventory plots. Specifically, function `fuel_stratification()` provides a stratification of the stand into understory and canopy strata; and `fuel_FCCS()` calculates fuel characteristics. Function `fuel_cohortFineFMC()` allows obtaining daily fuel moisture content estimates corresponding to the water status of plants, as returned by function `spwb()`. A fire behaviour model is implemented in function `fire_FCCS()` to calculate the intensity of surface fire reaction and the rate of fire spread of surface fires assuming a steady-state fire. Fuel and fire behaviour functions allow obtaining the following: 

1. Fuel characteristics by stratum.
2. Surface fire behavior (i.e. reaction intensity, rate of spread, fireline intensity and flame length).
3. Crown fire behavior.
4. Fire potential ratings of surface fire behavior and crown fire behavior.

### Implementation

The package has a user interface in R, but simulation functions and many calculations have been implemented in C++ and linked to R via the **Rcpp** package. 